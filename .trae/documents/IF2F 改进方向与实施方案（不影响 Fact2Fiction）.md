## 目标

* 从小处着手，先做 2–3 个低风险、可验证的微改，仅作用于 if2f，直接对 ASR/SFR 产生正向影响。

## 微改 1：锚点增强（标题+首段，轻量版）

* 内容：在 if2f 生成中，将 justification 中的高权重关键词注入到标题与首段，保证早段出现“反向结论+关键词组合”。

* 作用：提升检索召回与排序靠前（提高伪证被使用率→SFR），并通过首段强结论影响最终 verdict（助力 ASR）。

* 实施：仅改动 create\_if2f\_attack；加入轻量权重分配与首段关键词拼接；缓存键后缀增加 "\_if2f\_anchor\_v1"，避免影响 fact2fiction（参考 [缓存键构造](file:///h:/Fact2Fiction/src/attack/main.py#L321-L329)）。

* 度量：对 dev 集少量样本（如 limit=50）对比 SFR/ASR 与伪证使用率，期望 SFR↑，ASR小幅↑。

## 微改 2：伪来源 URL 模拟（最小替换）

* 内容：不再使用随机 URL + "/created"；改为基于原证据域名派生近似子路径（如同域/相似子域），提升可信度。

* 作用：提高被检索后选用概率（SFR↑），为后续更强反转提供基础。

* 实施：仅在 if2f 分支替换 URL 构造逻辑，不改其他攻击类型；缓存与文件名保持现有命名方案（见 \[资源/knn 命名]\(file:///h:/Fact2Fiction/src/attack/main.py#L182-L186, file:///h:/Fact2Fiction/src/attack/main.py#L331-L333)）。

* 度量：观察伪证在 used\_evidence 中占比变化与平均排名分布（简单统计 Top-N 命中）。

## 微改 3：生成结果质量过滤与去重（轻量规则）

* 内容：在注入前过滤空白/过短/无关键词文本，做简单去重；只保留“含锚点且长度达标”的伪证据。

* 作用：减少无效伪证，提升检索成功率与一致性（SFR↑），避免“弱文本”拉低 ASR。

* 实施：仅在 if2f 的结果列表上应用过滤，不修改公共管线；失败时回退到缓存或再采样。

* 度量：记录过滤前后伪证数量与使用率变化，确认质量提升带来的 SFR 改善。

## 验证与回滚

* 运行：仅对 if2f 与 dev 小样本执行，保持 n\_processes/gpu\_ids 不变，确保对 fact2fiction 零影响。

* 验收目标：

  * SFR：+3–8% 相对提升（样本内）

  * ASR：+1–3% 初步提升（通过首段强结论与锚点）

* 若未达标：

  * 优先加大锚点密度或调整首段长度；保留回滚路径（不改公共函数与缓存结构）。

## 下一步（通过本次数据决定）

* 若 SFR 显著提升且 ASR仍偏低：在 if2f 增加“反证力度”参数与模板微调（第二阶段微改）。

* 若两者均提升：继续扩大样本并观察稳定性，再考虑多轮自适应。

<br />

<br />

已做两项微改，仅作用 if2f，不影响 fact2fiction

* 固定查询与锚点增强
  * 证据拼接时，改为使用该问题的首个查询且同时拼接 claim\_text，提升检索一致性与语义对齐强度
  * 位置：create\_if2f\_attack 的拼接逻辑，见 attack\_methods.py:L900-L918
* 降低证据生成温度
  * 为 if2f 的证据生成传入 temperature=0.7，减少文本随机性，使内容更稳定、更易被检索匹配
  * 新增可选参数不影响其他攻击；位置：函数签名与调用，见 fabricate\_evidence\_for\_qa 、 attack\_methods.py:L887-L888

